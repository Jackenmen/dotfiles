#!/usr/bin/env python3

import os
import sys
from contextlib import ExitStack

from lxml import etree, html


HOME = os.path.expanduser("~")

BASE = f"""<opt>
  <general />
</opt>"""


with ExitStack() as stack:
    try:
        fp = stack.enter_context(open(f"{HOME}/.shutter/settings.xml"))
    except FileNotFoundError:
        contents = BASE
    else:
        contents = fp.read()
root = etree.fromstring(contents)
general_node = root.find("general")
general_node.attrib["autofs"] = "1"
general_node.attrib["autofs_min"] = "1"
general_node.attrib["last_profile_name"] = "default"
general_node.attrib["filename"] = "$nb_name_%Y-%m-%d_%H-%M-%S"
general_node.attrib["filetype"] = "0"
general_node.attrib["folder"] = f"{HOME}/Pictures/Screenshots"

print(etree.tostring(root).decode().replace("/>", " />"))
